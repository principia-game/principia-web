{% extends "_layout.twig" %}

{% set title = name %}
{% set description = userpagedata.about|replace({"\r":'',"\n":' '}) %}
{% set pagename = archive_prefix() ~ "/user/" ~ id %}

	{% block content %}
{% if action == 'ban' %}
	<div class="header_message">Successfully banned this user.</div>
{% elseif action == 'unban' %}
	<div class="header_message">Successfully unbanned this user.</div>
{% endif %}

{% if not constant('IS_ARCHIVE') %}

{% if userpagedata.avatar %}
	{% set avatar = avatar_url(userpagedata) %}
{% else %}
	{% set avatar = "/assets/no_avatar.png" %}
{% endif %}
<div class="user_header">
	<div class="user_main_meta">
		<div class="user_pic">
			<img src="{{ avatar }}" alt="(Avatar)">
		</div>

		<div class="user_meta">
			<h1>{{ name }}
				{% if userpagedata.pronouns %}<span class="pronouns">({{ userpagedata.pronouns }})</span>{% endif %}
			</h1>

			<div class="meta_row">
				<span class="meta_item">
					<b>Levels</b>: {{ level_count }}
				</span>

				<span class="meta_item">
					<b>Threads</b>: {{ userpagedata.threads }}
					(<a href="/forum/forum?user={{ id }}">Show</a>)
				</span>
				<span class="meta_item">
					<b>Posts</b>: {{ userpagedata.posts }}
					(<a href="/forum/thread?user={{ id }}">Show</a>)
				</span>
			</div>

			<div class="meta_row">
				<span class="meta_item">
					<b>Registered</b>:
					{{ userpagedata.joined | date('Y-m-d') }}
				</span>
				<span class="meta_item">
					<b>Last view</b>:
					{{ userpagedata.lastview | relative_time }}
				</span>
				{% if userdata.rank > 2 %}
					<span class="meta_item">
						<b>IP</b>:
						<span class="sensitive">{{ userpagedata.ip | ipv6_to_ipv4 }}</span>
					</span>
				{% endif %}
			</div>
		</div>
	</div>
	<div class="user_sidebar">
		<h3>Badges
			{% if badges %}<a href="/user/{{ id }}/badges" style="float: right;">(View all)</a>{% endif %}
		</h3>

		<div class="badges-collapsed">
			{% for badge in badges %}
			<div class="badge">
				<img src="/icons/badges/{{ badge.name }}.svg" alt="{{ badge.name }}" title="{{ badge.title }}">
			</div>
			{% else %}
				<p class="center fullwidth"> ~ dust ~ </p>
			{% endfor %}
		</div>
	</div>
</div>

<h3>About this user</h3>
{{ userpagedata.about | default("*This user hasn't written anything about themselves yet...*") | markdown }}

<hr>

{% if userpagedata.archivename %}
	<h3><a href="/archive/user/{{ userpagedata.archivename }}">
		View this user's levels on the official community site archive
	</a></h3>
{% endif %}

{% if log %}
	<p>
		<strong>User actions:</strong>

		{% if userdata.id != id %}
			<a href="/forum/sendprivate?uid={{ id }}">
				Send private message</a>
		{% else %}
			<a href="/user/{{ id }}">
				Go to personal user page</a>
		{% endif %}
		{% if userdata.rank > 2 %}
			&ndash;
			<a href="/resetpassword?grf={{ id }}">
				Generate password reset for user</a>
			&ndash;
			<a href="/user/{{ id }}/givebadge">
				Give badge</a>
		{% endif %}
		{% if userdata.rank > 1 %}
			&ndash;
			<a href="/admin/ban_user?id={{ id }}">
				{% if userpagedata.rank < 0 %}Unb{% else %}B{% endif %}an user</a>
		{% endif %}
	</p>
{% endif %}

{% else %}
	<h1>{{ name }}
		{% if constant('IS_ARCHIVE') %}<span style="padding-left: 5px" title="This user is part of the official community site archive.">{{ icon("archive") }}</span>{% endif %}
	</h1>

	{% if name == "zardOz" %}
		<p><a href="/archive/level/20830">R.I.P. zardOz</a></p>
	{% endif %}
{% endif %}

<h2>Levels</h2>

<div class="level-list">
	{% for level in levels %}
		{{ level(level) }}
	{% else %}
		This user hasn't uploaded any levels.
	{% endfor %}
</div>

{% if userdata.id == id %}
	{% set forceuser = "&forceuser" %}
{% else %}
	{% set forceuser = "" %}
{% endif %}
{% set le_url = archive_prefix() ~ '/user/' ~ id ~ '?page=%s' ~ forceuser %}
{{ pagination(level_count, glob_lpp, le_url, page) }}

{% if not constant('IS_ARCHIVE') %}
	{{ comments(comments, 'user', id) }}
{% endif %}

	{% endblock %}
